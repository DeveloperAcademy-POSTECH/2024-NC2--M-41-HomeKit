# 2024-NC2-M41-AugmentedReality
## ğŸ¥ Youtube Link
(ì¶”í›„ ë§Œë“¤ì–´ì§„ ìœ íŠœë¸Œ ë§í¬ ì¶”ê°€)

## ğŸ’¡ About Augmented Reality
(í•´ë‹¹ ê¸°ìˆ ì— ëŒ€í•œ ì¡°ì‚¬ ë‚´ìš© ì •ë¦¬)
> í™ˆí‚·ì„ ë°”íƒ•ìœ¼ë¡œ íœ´ëŒ€í°ì„ ì´ìš©í•´ ì§‘ì— ìˆëŠ” ì „êµ¬ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤

## ğŸ¯ What we focus on?
> í™ˆ ì•±ì— ì¶”ê°€ëœ ê¸°ê¸°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì•± ë‚´ì—ì„œ íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•˜ë©´ íƒ€ì´ë¨¸ ì¢…ë£Œì‹œê°„ì— ë§ì¶”ì–´ ê¸°ê¸°(ì „êµ¬)ì˜ ì ë©¸ì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ ì•Œë¦½ë‹ˆë‹¤.
> ì²­ê°ì¥ì• ì¸ì„ ì£¼ìš” ì•± ì‚¬ìš©ìë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ì†Œë¦¬ë¥¼ ì¸ì§€í•  ìˆ˜ ì—†ëŠ” ëŒ€ìƒì„ ìœ„í•´ ì†Œë¦¬ ëŒ€ì‹  ì „êµ¬ì˜ ì ë©¸ë¡œ ì–´ë– í•œ ìƒí™©ì„ ì•Œë¦¬ìëŠ” ëª©í‘œë¥¼ ì„¸ì› ê³ , ê·¸ ì¤‘ì—ì„œë„ ì‹œê°„ì„ ì¬ê³  ì¢…ë£Œ ì‹œì ì„ í™•ì‹¤íˆ ì¸ì§€í•´ì•¼ í•˜ëŠ” ì¼ì— ì´ˆì ì„ ë‘ì—ˆìŠµë‹ˆë‹¤.

## ğŸ’¼ Use Case
>- ì„¸íƒê¸°ë¥¼ ì‘ë™í•œ í›„ì— ì¢…ë£Œ ì‹œì ì— ë§ì¶”ì–´ íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•˜ê³  ì‚¬ìš©í•œë‹¤.
>- ë°¥ì†¥ìœ¼ë¡œ ë°¥ì„ ì§“ê³  íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•œë‹¤.
>- ìˆ˜ìœ¡ì„ ì‚¶ëŠ”ë°ì— ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ”ë° ê³„ì†í•´ì„œ ë³´ê³ ìˆì„ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•œë‹¤.

## ğŸ–¼ï¸ Prototype
https://github.com/DeveloperAcademy-POSTECH/2024-NC2--M-41-HomeKit/assets/167425685/bff8b5bb-4130-4d9f-aca5-3817100ed49d
>- ì§‘ì—ì„œ ë°©ìœ¼ë¡œ ì ‘ê·¼í•´ íƒ€ì´ë¨¸ì™€ ì¡°ëª…ì„ ì„¤ì •í•˜ê³ , íƒ€ì´ë¨¸ë¥¼ ì‘ë™ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
>- ì•…ì„¸ì„œë¦¬ì—ì„œ ì•…ì„¸ì„œë¦¬ ê°ê°ì— ëŒ€í•œ ìƒíƒœë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
>- ìµœê·¼ ì‚¬ìš©í•œ íƒ€ì´ë¨¸ì—ì„œ ê°€ì¥ ìµœê·¼ì— ì‚¬ìš©í•œ íƒ€ì´ë¨¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì£¼ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì´ë¼ë©´ ìµœê·¼ ì‚¬ìš©í•œ íƒ€ì´ë¨¸ì—ì„œ ê³„ì† ë³¼ ìˆ˜ ìˆì–´ ì‚¬ìš©ìí™”ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.


## ğŸ› ï¸ About Code
íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•œ ë’¤ ì¢…ë£Œë˜ë©´ ì „êµ¬ê°€ ì ë©¸í•œë‹¤
```swift
import SwiftUI
import Combine
import HomeKit

struct TimerView: View {
    @ObservedObject var homeKitManager: HomeKitManager
    @StateObject private var timerViewModel = TimerViewModel()
    @Binding var timerFinished: Bool
    @Binding var selectedTime: String
    @Binding var showPickerSection: Bool
    let timerTitle: String
    private let lightController: LightController
    let accessory: HMAccessory
    
    // ì´ë‹› ë¶€ë¶„
    init(accessory: HMAccessory, homeKitManager: HomeKitManager, lightController: LightController, timerFinished: Binding<Bool>, selectedTime: Binding<String>, showPickerSection: Binding<Bool>, timerTitle: String) {
        self.accessory = accessory
        self.homeKitManager = homeKitManager
        self.lightController = lightController
        self._timerFinished = timerFinished
        self._selectedTime = selectedTime
        self._showPickerSection = showPickerSection
        self.timerTitle = timerTitle
    }
    
    var body: some View {
        VStack {
            // íƒ€ì´ë¨¸ ì œëª© (Ex. ë¹¨ë˜ í›„ ê±´ì¡°)
            HStack{
                Text(timerTitle)
                    .font(.title)
                    .padding(.leading)
                    .bold()
                    .foregroundStyle(Color.white)
                Spacer()
            }
            .padding(.vertical, 20)
            
            // íƒ€ì´ë¨¸ ëŒì•„ê°€ëŠ” ìˆ«ì ë¶€ë¶„
            ZStack{
                // íƒ€ì´ë¨¸ ìˆ«ì
                Text(timerViewModel.timeString)
                    .font(.system(size: 40))
                    .padding()
                    .foregroundStyle(Color.white)
                // ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤ë·°
                RadialProgressView(progress: timerViewModel.progress)
                    .frame(width: 250, height: 250)
                // ì‹œê³„
            }
            .padding(.bottom, 20)
            
            // ì·¨ì†Œ, ì¼ì‹œì •ì§€/ì‹œì‘ ë²„íŠ¼
            HStack {
                // ì·¨ì†Œë²„íŠ¼
                Button(action: timerViewModel.reset) {
                    Text("ì·¨ì†Œ")
                        .foregroundColor(.white)
                        .frame(width: 92, height: 92)
                        .background(Color.gray.opacity(0.3))
                        .clipShape(Circle())
                }
                Spacer()
                // ì¼ì‹œì •ì§€/ì‹œì‘ ë²„íŠ¼
                Button(action: timerViewModel.toggleTimer) {
                    Text(timerViewModel.isRunning ? "ì¼ì‹œì •ì§€" : "ì‹œì‘")
                        .foregroundColor(timerViewModel.isRunning ? Color.yellow : Color.green)
                        .frame(width: 92, height: 92)
                        .background(timerViewModel.isRunning ? Color.yellow.opacity(0.3) : Color.green.opacity(0.3))
                        .clipShape(Circle())
                }
            }
            .padding(.horizontal)
            Spacer()
        }
        .background(Color.bgPrimaryDarkBase)
        // í™”ë©´ì´ ë‚˜íƒ€ë‚¬ì„ë•Œ
        .onAppear {
            let timeComponents = selectedTime.split(separator: ":").map { String($0) }
            if timeComponents.count == 3 {
                if let hours = Int(timeComponents[0]), let minutes = Int(timeComponents[1]), let seconds = Int(timeComponents[2]) {
                    timerViewModel.selectedHours = hours
                    timerViewModel.selectedMinutes = minutes
                    timerViewModel.selectedSeconds = seconds
                    timerViewModel.reset()
                }
            }
        }
        // íƒ€ì´ë¨¸ê°€ ì¢…ë£Œë˜ì—ˆì„ ë•Œ
        .onChange(of: timerViewModel.timerFinished, initial: false) { oldValue, newValue in
            if newValue {
                lightController.startBlinkingBulb(for: accessory)
            }
            else {
                lightController.stopBlinkingBulb()
            }
        }
        //íˆ´ ë°” ì¢…ë£Œë²„íŠ¼
        .toolbar {
            Button("ì¢…ë£Œ"){
                lightController.stopBlinkingBulb()
            }
            .foregroundStyle(Color.appYellow)
        }
    }
}

// íƒ€ì´ë¨¸ ì„¤ì •í•˜ëŠ” ë¶€ë¶„
struct PickerSection: View {
    @Binding var selectedTime: String
    @Binding var showPickerSection: Bool
    @ObservedObject var timerViewModel: TimerViewModel
    
    var body: some View {
        VStack{
            // ì‹œê°„, ë¶„, ì´ˆ ì„¤ì •
            HStack {
                // ì‹œê°„ ì„¤ì •
                Picker("Hours", selection: $timerViewModel.selectedHours) {
                    ForEach(0..<24) { hour in
                        Text("\(hour) h").tag(hour)
                    }
                }
                .pickerStyle(WheelPickerStyle())
                .frame(width: 90)
                .clipped()
                
                // ë¶„ ì„¤ì •
                Picker("Minutes", selection: $timerViewModel.selectedMinutes) {
                    ForEach(0..<60) { minute in
                        Text("\(minute) m").tag(minute)
                    }
                }
                .pickerStyle(WheelPickerStyle())
                .frame(width: 90)
                .clipped()
                
                // ì´ˆ ì„¤ì •
                Picker("Seconds", selection: $timerViewModel.selectedSeconds) {
                    ForEach(0..<60) { second in
                        Text("\(second) s").tag(second)
                    }
                }
                .pickerStyle(WheelPickerStyle())
                .frame(width: 90)
                .clipped()
            }
            .padding()
            // ì…‹íŒ… ì™„ë£Œ í›„ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìœ„ì˜ ìˆ«ìê°€ ë³€ê²½ëœë‹¤
            Button("set time") {
                selectedTime = String(format: "%02d:%02d:%02d", timerViewModel.selectedHours, timerViewModel.selectedMinutes, timerViewModel.selectedSeconds)
                showPickerSection = false
            }
        }
    }
}

// ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤ë·°
struct RadialProgressView: View {
    var progress: Double
    
    var body: some View {
        ZStack {
            Circle()
                .stroke(lineWidth: 20.0)
                .opacity(0.3)
                .foregroundColor(Color.appYellow)
            
            Circle()
                .trim(from: 0.0, to: CGFloat(min(progress, 1.0)))
                .stroke(style: StrokeStyle(lineWidth: 20.0, lineCap: .round, lineJoin: .round))
                .foregroundColor(Color.appYellow)
                .rotationEffect(Angle(degrees: 270.0))
                .opacity(0.8)
                .animation(.linear, value: progress)
        }
    }
}

// íƒ€ì´ë¨¸ ëª¨ë¸.. êµ‰ì¥íˆ ë³µì¡..
class TimerViewModel: ObservableObject {
    @Published var timeString: String = "00:00:00"
    @Published var progress: Double = 1.0
    @Published var selectedHours: Int = 0
    @Published var selectedMinutes: Int = 0
    @Published var selectedSeconds: Int = 0
    @Published var savedTimes: [String] = []
    @Published var isRunning: Bool = false
    @Published var timerFinished: Bool = false
    
    private var cancellable: AnyCancellable?
    private var totalTime: TimeInterval = 0
    private var remainingTime: TimeInterval = 0
    
    // íƒ€ì´ë¨¸ on/off
    func toggleTimer() {
        if isRunning {
            stop()
        } else {
            start()
        }
    }
    
    // íƒ€ì´ë¨¸ê°€ ì‹œì‘ëœë‹¤
    func start() {
        stop()
        totalTime = TimeInterval(selectedHours * 3600 + selectedMinutes * 60 + selectedSeconds)
        remainingTime = totalTime
        
        isRunning = true
        timerFinished = false
        
        cancellable = Timer.publish(every: 1.0, on: .main, in: .common)
            .autoconnect()
            .sink { _ in
                self.updateTime()
            }
    }
    
    // íƒ€ì´ë¨¸ ì •ì§€
    func stop() {
        cancellable?.cancel()
        cancellable = nil
        isRunning = false
    }
    
    // íƒ€ì´ë¨¸ ë¦¬ì…‹
    func reset() {
        stop()
        remainingTime = totalTime
        progress = 1.0
        timeString = formatTime(time: remainingTime)
        timerFinished = false
    }
    
    // ì‹œê°„ ì €ì¥ì¸ë° CRUD ì‹¤íŒ¨ë¡œ ì‚¬ìš©í•˜ì§€ ëª»í•œ ì•„ì´..
    func saveTime() {
        let savedTime = String(format: "%02d:%02d:%02d", selectedHours, selectedMinutes, selectedSeconds)
        savedTimes.append(savedTime)
    }
    
    // ì‹œê°„ ì—…ëƒ
    private func updateTime() {
        if remainingTime > 0 {
            remainingTime -= 1
        }
        timeString = formatTime(time: remainingTime)
        progress = totalTime > 0 ? remainingTime / totalTime : 1.0
        if remainingTime == 0 {
            stop()
            timerFinished = true
        }
    }
    // ì‹œê°„ì„ ë¬¸ìì—´ë¡œ í¬ë§·íŒ…
    private func formatTime(time: TimeInterval) -> String {
        let hours = Int(time) / 3600
        let minutes = (Int(time) % 3600) / 60
        let seconds = Int(time) % 60
        return String(format: "%02d:%02d:%02d", hours, minutes, seconds)
    }
}

```

